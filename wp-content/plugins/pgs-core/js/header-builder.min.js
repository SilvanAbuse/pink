function elementDraggable(){jQuery(".chl-element-sortable").sortable({scroll:!1,cursor:"move",connectWith:".chl-element-sortable",opacity:.7,helper:"original",placeholder:"chl-element-sortable-placeholder",start:function(e,a){var l=a.item.html();a.placeholder.html(l)},sort:function(e,a){elementActionHideShow()},stop:function(e,a){elementActionHideShow()}}).disableSelection(),jQuery(".chl-elements-list .chl-sortable-item").draggable({scroll:!1,cursor:"move",opacity:.7,stack:".chl-sortable-item",helper:"clone"}),jQuery(".chl-element-sortable").droppable({accept:".chl-elements-list .chl-sortable-item",drop:function(e,a){var l=jQuery(this),t=a.draggable,n=a.draggable.find(".chl-element-content").data("element_title"),i=a.draggable.find(".chl-element-content").data("element_id"),c=[];c.unshift({element_id:i,element_title:n});var r=JSON.stringify(c);t.clone().appendTo(l).find(".chl-element-content").attr("data-element_data",r),elementActionHideShow()}})}function elementActionHideShow(){jQuery(".chl-element-sortable").each(function(){jQuery(this).find(".chl-sortable-item").length+jQuery(this).find(".chl-element-sortable-placeholder").length<=0?jQuery(this).removeClass("chl-has-elements"):jQuery(this).addClass("chl-has-elements")})}function get_element_field(t,n){if(t){var i=classes=value=element_value=$data_attr="";switch(n&&null!=n[t.param_name]&&(value=n[t.param_name]),t.default&&(value||(value=t.default)),null!=t.classes&&(classes=t.classes),t.dependency&&(jQuery.each(t.dependency,function(e,a){"element"==e?element_name=a:"value"==e&&(element_value=JSON.stringify(a))}),dependency=JSON.stringify(t.dependency),$data_attr="data-dependency-element='"+element_name+"' data-dependency-value='"+element_value+"'"),i+="<div class='chl-field-option' data-content='"+t.group+"' "+$data_attr+">",i+='<div class="chl-field-label">'+t.heading+"</div>",i+='<div class="chl-field-input-cover '+t.type+'">',t.type){case"pgscore_range_slider":min=""!=t.min?t.min:0,max=""!=t.max?t.max:100,unit=""!=t.unit?t.unit:"",t.label&&(i+='<label class="chl-radio-label pgs-range-slider" for="'+t.param_name+'">',i+=t.label,i+="</label>"),i+='<input type="hidden" class="pgscore_range_slider chl-field-input" name="'+t.param_name+'" value="'+value+'">',i+='<div class="pgscore-range-slider" data-min_value="'+min+'" data-max_value="'+max+'" data-unit="'+unit+'"></div>';break;case"textarea_html":data=decodeURIComponent(value),data2=decodeURIComponent(data),i+='<textarea id="textarea_html" name="'+t.param_name+'">'+data2+"</textarea>";break;case"textfield":var e="";t.placeholder&&(e=t.placeholder),i+='<input class="chl-field-input chl-field-textfield textfield" type="text" placeholder="'+e+'" name="'+t.param_name+'" value="'+value+'"/>';break;case"dropdown":multiple="",value=value.split(", "),dropdownClass="chl-field-input chl-field-dropdown dropdown",t.multiple&&(multiple=' multiple="multiple"'),t.enable_select2&&(dropdownClass+=" select2-enabled"),i+='<select class="'+dropdownClass+'" name="'+t.param_name+'"'+multiple+">",jQuery.each(t.options,function(e,a){var l="";-1!==jQuery.inArray(e,value)&&(l="selected"),i+='<option value="'+e+'" '+l+">"+a+"</option>"}),i+="</select>";break;case"checkbox":var a="";value&&(a="checked"),i+='<label class="chl-label chl-checkout-label" for="'+t.param_name+'">',i+='<input type="checkbox" id="'+t.param_name+'" value="true" class="chl-field-input chl-checkbox '+classes+'" name="'+t.param_name+'" '+a+">",i+='<span class="chl-checkout-title">'+t.options+"</span>",i+="</label>";break;case"checkbox_multi":jQuery.each(t.options,function(e,a){var l="";n[e]?l="checked":a.default&&(l="checked"),i+='<label class="chl-label chl-checkout-label" for="'+e+'">',i+='<input type="checkbox" id="'+e+'" value="true" class="chl-field-input chl-checkbox '+classes+'" name="'+e+'" '+l+">",i+='<span class="chl-checkout-title">'+a.heading+"</span>",i+="</label>"});break;case"radio_buttonset":jQuery.each(t.options,function(e,a){var l="";e==value&&(l="checked"),i+='<label class="chl-label chl-radio-label" for="'+t.param_name+"-"+e+'">',i+='<input type="radio" id="'+t.param_name+"-"+e+'" value="'+e+'" class="chl-field-input chl-radio '+classes+'" name="'+t.param_name+'" '+l+">",i+='<span class="chl-radio-title">'+a+"</span>",i+="</label>"});break;case"radio_image":jQuery.each(t.options,function(e,a){var l="";e==value&&(l="checked"),i+='<label class="chl-label chl-radio-label" for="'+t.param_name+"-"+e+'">',i+='<input type="radio" id="'+t.param_name+"-"+e+'" value="'+e+'" class="chl-field-input chl-radio '+classes+'" name="'+t.param_name+'" '+l+">",i+='<span class="chl-radio-title"><img class="radio_image_picker" src="'+a+'"></span>',i+="</label>"});break;case"radio":jQuery.each(t.options,function(e,a){var l="";e==value&&(l="checked"),i+='<label class="chl-label chl-radio-label" for="'+t.param_name+"-"+e+'">',i+='<input type="radio" id="'+t.param_name+"-"+e+'" value="'+e+'" class="chl-field-input chl-radio-button '+classes+'" name="'+t.param_name+'" '+l+">",i+='<span class="chl-radio-title">'+a+"</span>",i+="</label>"});break;case"radio_icon":jQuery.each(t.options,function(e,a){var l="";e==value&&(l="checked"),i+='<label class="chl-label chl-radio-label" for="'+t.param_name+"-"+e+'">',i+='<input type="radio" id="'+t.param_name+"-"+e+'" value="'+e+'" class="chl-field-input chl-radio '+classes+'" name="'+t.param_name+'" '+l+">",i+='<span class="chl-radio-title">'+a+"</span>",i+="</label>"});break;case"colorpicker":i+='<input class="chl-field-input chl-field-colorpicker colorpicker color-picker" data-alpha="true" type="text" placeholder="" name="'+t.param_name+'" value="'+value+'"/>';break;case"background_settings":var l={},c=null==n[t.param_name+"_bg_src"]?"hidden":"",r=null!=n[t.param_name+"_bg_image"]?n[t.param_name+"_bg_image"]:"",s=null!=n[t.param_name+"_bg_src"]?n[t.param_name+"_bg_src"]:"",o=null!=n[t.param_name+"_bg_color"]?n[t.param_name+"_bg_color"]:"",d=null!=n[t.param_name+"_bg_repeat"]?n[t.param_name+"_bg_repeat"]:"inherit",h=null!=n[t.param_name+"_bg_size"]?n[t.param_name+"_bg_size"]:"inherit",u=null!=n[t.param_name+"_bg_attachment"]?n[t.param_name+"_bg_attachment"]:"inherit",m=null!=n[t.param_name+"_bg_position"]?n[t.param_name+"_bg_position"]:"inherit";i+='<div class="chl-background-setting-field">',i+='<label class="chl-label" for="'+t.param_name+'_bg_image"> <span class="chl-label-title">'+chl.upload_image+"</span> </label>",i+='<div class="chl-field-media-cover '+c+'">',s&&(i+='<img src="'+s+'">'),i+="</div>",i+='<input class="chl-field-input button chl-button button-large chl-field-media media-upload" id="'+t.param_name+'_bg_image" type="button" value="Upload"/>',i+='<input class="chl-field-input button chl-button button-large chl-remove-media-button '+c+'" type="button" value="Remove"/>',i+='<input class="chl-field-input chl-field-media-id hidden" type="text" name="'+t.param_name+'_bg_image" value="'+r+'"/>',i+='<input class="chl-field-input chl-field-media-src hidden" type="text" name="'+t.param_name+'_bg_src" value="'+s+'"/>',i+="</div>",i+='<div class="chl-background-setting-field">',i+='<label class="chl-label" for="'+t.param_name+'_bg_color"> <span class="chl-label-title">'+chl.color+"</span> </label>",i+='<input class="chl-field-input chl-field-colorpicker colorpicker color-picker" data-alpha="true" id="'+t.param_name+'_bg_color" type="text" name="'+t.param_name+'_bg_color" value="'+o+'"/>',i+="</div>",i+='<div class="chl-background-setting-field">',i+='<label class="chl-label" for="'+t.param_name+'_bg_repeat"> <span class="chl-label-title">'+chl.image_repeat+"</span> </label>",i+='<select class="chl-field-input chl-field-dropdown dropdown" id="'+t.param_name+'_bg_repeat" name="'+t.param_name+'_bg_repeat">',l={inherit:"Inherit","no-repeat":"No repeat",repeat:"Repeat All","repeat-x":"Repeat Horizontally","repeat-y":"Repeat Vertically"},jQuery.each(l,function(e,a){i+=d==e?'<option value="'+e+'" selected="selected">'+a+"</option>":'<option value="'+e+'">'+a+"</option>"}),i+="</select>",i+="</div>",i+='<div class="chl-background-setting-field">',i+='<label class="chl-label" for="'+t.param_name+'_bg_size"> <span class="chl-label-title">'+chl.image_size+"</span> </label>",i+='<select class="chl-field-input chl-field-dropdown dropdown" id="'+t.param_name+'_bg_size" name="'+t.param_name+'_bg_size">',l={inherit:"Inherit",cover:"Cover",contain:"Contain"},jQuery.each(l,function(e,a){i+=h==e?'<option value="'+e+'" selected="selected">'+a+"</option>":'<option value="'+e+'">'+a+"</option>"}),i+="</select>",i+="</div>",i+='<div class="chl-background-setting-field">',i+='<label class="chl-label" for="'+t.param_name+'_bg_attachment"> <span class="chl-label-title">'+chl.image_attachment+"</span> </label>",i+='<select class="chl-field-input chl-field-dropdown dropdown" id="'+t.param_name+'_bg_attachment" name="'+t.param_name+'_bg_attachment">',l={inherit:"Inherit",fixed:"Fixed",scroll:"Scroll"},jQuery.each(l,function(e,a){i+=u==e?'<option value="'+e+'" selected="selected">'+a+"</option>":'<option value="'+e+'">'+a+"</option>"}),i+="</select>",i+="</div>",i+='<div class="chl-background-setting-field">',i+='<label class="chl-label" for="'+t.param_name+'_bg_position"> <span class="chl-label-title">'+chl.image_position+"</span> </label>",i+='<select class="chl-field-input chl-field-dropdown dropdown" id="'+t.param_name+'_bg_position" name="'+t.param_name+'_bg_position">',l={inherit:"Inherit","left top":"Left Top","left center":"Left Center","left bottom":"Left Bottom","center top":"Center Top","center center":"Center Center","center bottom":"Center Bottom","right top":"Right Top","right center":"Right Center","right bottom":"Right Bottom"},jQuery.each(l,function(e,a){i+=m==e?'<option value="'+e+'" selected="selected">'+a+"</option>":'<option value="'+e+'">'+a+"</option>"}),i+="</select>",i+="</div>";break;case"color_settings":var p=null!=n[t.param_name+"_color"]?n[t.param_name+"_color"]:"",v=null!=n[t.param_name+"_link_color"]?n[t.param_name+"_link_color"]:"",_=null!=n[t.param_name+"_hover_color"]?n[t.param_name+"_hover_color"]:"";0!=t.text_color&&(i+='<div class="chl-color-setting-field">',i+='<label class="chl-label" for="'+t.param_name+'_color"> <span class="chl-label-title">'+chl.text_color+"</span> </label>",i+='<input class="chl-field-input chl-field-colorpicker colorpicker color-picker" type="text" placeholder="" name="'+t.param_name+'_color" value="'+p+'"/>',i+="</div>"),0!=t.link_color&&(i+='<div class="chl-color-setting-field">',i+='<label class="chl-label" for="'+t.param_name+'_link_color"> <span class="chl-label-title">'+chl.link_color+"</span> </label>",i+='<input class="chl-field-input chl-field-colorpicker colorpicker color-picker" type="text" placeholder="" name="'+t.param_name+'_link_color" value="'+v+'"/>',i+="</div>"),0!=t.hover_color&&(i+='<div class="chl-color-setting-field">',i+='<label class="chl-label" for="'+t.param_name+'_hover_color"> <span class="chl-label-title">'+chl.link_hover_color+"</span> </label>",i+='<input class="chl-field-input chl-field-colorpicker colorpicker color-picker" type="text" placeholder="" name="'+t.param_name+'_hover_color" value="'+_+'"/>',i+="</div>");break;case"border_settings":var y=null!=n[t.param_name+"_width"]?n[t.param_name+"_width"]:0,b=(p=null!=n[t.param_name+"_color"]?n[t.param_name+"_color"]:"",null!=n[t.param_name+"_style"]?n[t.param_name+"_style"]:"solid");boder_width=null!=n[t.param_name+"_border_width"]?n[t.param_name+"_border_width"]:"full_width",i+='<div class="chl-border-setting-field">',i+='<label class="chl-label" for="'+t.param_name+'_width"> <span class="chl-label-title">'+chl.width+"</span> </label>",i+='<input class="chl-field-input chl-field-number" type="number" placeholder="" min="0" max="10" name="'+t.param_name+'_width" value="'+y+'"/>',i+="</div>",i+='<div class="chl-border-setting-field">',i+='<label class="chl-label" for="'+t.param_name+'_style"> <span class="chl-label-title">'+chl.style+"</span> </label>",i+='<select class="chl-field-input chl-field-dropdown dropdown" id="'+t.param_name+'_style" name="'+t.param_name+'_style">',l={dotted:"Dotted",dashed:"Dashed",solid:"Solid",double:"Double",groove:"Groove",ridge:"Ridge",inset:"Inset",outset:"Outset",initial:"Initial",inherit:"Inherit"},jQuery.each(l,function(e,a){i+=b==e?'<option value="'+e+'" selected="selected">'+a+"</option>":'<option value="'+e+'">'+a+"</option>"}),i+="</select>",i+="</div>",i+='<div class="chl-border-setting-field">',i+='<label class="chl-label" for="'+t.param_name+'_border_width"><span class="chl-label-title">'+chl.border_width+"</span></label>",i+='<select class="chl-field-input chl-field-dropdown dropdown" id="'+t.param_name+'_border_width" name="'+t.param_name+'_border_width">',l={full_width:chl.full_width,container:chl.container},jQuery.each(l,function(e,a){boder_width==e?i+='<option value="'+e+'" selected="selected">'+a+"</option>":i+='<option value="'+e+'">'+a+"</option>"}),i+="</select>",i+="</div>",i+='<div class="chl-border-setting-field last-field">',i+='<label class="chl-label" for="'+t.param_name+'_color"> <span class="chl-label-title">'+chl.color+"</span> </label>",i+='<input class="chl-field-input chl-field-colorpicker colorpicker color-picker" type="text" placeholder="" name="'+t.param_name+'_color" value="'+p+'"/>',i+="</div>"}return i+="</div>",null!=t.description&&(i+='<span class="chl-description">'+t.description+"</span>"),i+="</div>"}}function fieldsActionHideShow(){jQuery(".chl-field-option").each(function(){var e=jQuery(".chl-edit-tabs .chl-tabs-title.chl-tab-active").data("tab");jQuery(this).data("content")==e?jQuery(this).show():jQuery(this).hide()}),formDataDependency()}function fieldsEditor(){wp.editor.initialize("textarea_html",{tinymce:{wpautop:!0},quicktags:!0,mediaButtons:!1})}function fieldsEditorRemove(){tinymce.get("textarea_html")&&wp.editor.remove("textarea_html")}function getRangeSlider(){jQuery(".pgscore-range-slider").each(function(){var e=jQuery(this).parent().find(".pgscore_range_slider").val(),a=jQuery(this).data("min_value"),l=jQuery(this).data("max_value"),t=jQuery(this).data("unit"),n=jQuery(this).parent().find("label.pgs-range-slider").text();jQuery(this).slider({range:"min",value:""!=e?e:10,min:a,max:l,slide:function(e,a){jQuery(this).parent().find(".pgscore_range_slider").val(a.value),jQuery(this).parent().find("label.pgs-range-slider").text(n+": "+a.value+t)}}),jQuery(this).parent().find("label.pgs-range-slider").text(n+": "+jQuery(this).slider("value")+t)})}function formDataDependency(){jQuery("form#header_builder_elements_form :input").each(function(){if(this.checked){var e=jQuery(this).val(),a=jQuery(this).attr("name"),l=jQuery(".chl-edit-tabs .chl-tabs-title.chl-tab-active").data("tab");jQuery('[data-dependency-element="'+a+'"]').each(function(){dependency=jQuery(this).data("dependency-value"),dependency_tab=jQuery(this).data("content"),-1==jQuery.inArray(e,dependency)?jQuery(this).hide():dependency_tab==l&&jQuery(this).show()})}})}function setColorPicker(){jQuery(".color-picker").wpColorPicker()}function enableSelect2(){jQuery(".select2-enabled").select2({containerCssClass:"chl-gropdown-container"})}function device_related_elements(){var e=jQuery(".chl-toolbar-devices span.active-devices").data("device");e&&("desktop"==e&&(jQuery(".chl-element-for-mobile").hide(),jQuery(".chl-element-for-desktop").show()),"mobile"==e&&(jQuery(".chl-element-for-desktop").hide(),jQuery(".chl-element-for-mobile").show()))}jQuery(document).ready(function(){var l;jQuery(".add-header-layout").on("click",function(e){e.preventDefault(),jQuery(".chl-preset-header-container").hasClass(".chl-header-list-active")?jQuery(".chl-preset-header-container").removeClass("chl-header-list-active"):jQuery(".chl-preset-header-container").addClass("chl-header-list-active")}),jQuery(".chl-preset-header-close").on("click",function(e){e.preventDefault(),jQuery(".chl-preset-header-container").removeClass("chl-header-list-active")}),jQuery(document).on("click",".header-layout",function(e){e.preventDefault();var a=jQuery(this).data("layout"),l=jQuery(this).find("a").attr("href");jQuery(this).parents(".chl-preset-header-inner").append('<div class="chl-loading"></div>'),jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"add_sample_header",layout:a},dataType:"json",success:function(e){l+="&header_id="+e.header_id,jQuery(".chl-loading").remove(),jQuery(location).attr("href",l)}})}),device_related_elements(),jQuery(".chl-toolbar-devices span").on("click",function(){jQuery(this).hasClass("active-devices")||(jQuery(".chl-toolbar-devices span").removeClass("active-devices"),jQuery(this).addClass("active-devices"),"desktop"==jQuery(this).data("device")&&(jQuery(".chl-structure").removeClass("chl-structure-mobile"),jQuery(".chl-structure").addClass("chl-structure-desktop"),device_related_elements()),"mobile"==jQuery(this).data("device")&&(jQuery(".chl-structure").removeClass("chl-structure-desktop"),jQuery(".chl-structure").addClass("chl-structure-mobile"),device_related_elements()))}),jQuery(".chl-element-content .chl-remove-btn").live("click",function(){confirm("Are you sure to delete this element?")&&(jQuery(this).parents(".chl-sortable-item").remove(),elementActionHideShow())}),jQuery(".chl-element-content .chl-clone-btn").live("click",function(){var e=jQuery(this).parents(".chl-sortable-item").html();jQuery(this).parents(".chl-element-sortable").append('<li class="chl-sortable-item">'+e+"</li>")}),jQuery(".chl-element-sortable .chl-element-content-inner").live("click",function(){if(!jQuery(this).parents(".chl-element-content").hasClass("chl-element-current")){jQuery(".chl-structure").append('<div class="chl-settings-loading"></div>'),jQuery(".chl-device-elements-settings").html(""),jQuery(".chl-device-elements-settings").removeClass("chl-elements-settings-show"),jQuery(".chl-element-content").removeClass("chl-element-current"),jQuery(".chl-elements-cover").removeClass("chl-current-row"),jQuery(this).parents(".chl-element-content").addClass("chl-element-current");var e=jQuery(this).parents(".chl-element-content").data("element_id"),a=jQuery(this).parents(".chl-element-content").data("element_title"),l=jQuery(this).parents(".chl-element-content").attr("data-element_data"),n="";null!=l&&""!=l&&(elements_data_arr=JSON.parse(l),n=[],jQuery.each(elements_data_arr,function(e,a){n[a.name]?n[a.name]=n[a.name]+", "+a.value:n[a.name]=a.value})),jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"edit_element",elementId:e},dataType:"json",success:function(e){var l="",t="";$tabs=[],$active_tab=!0,jQuery.each(e,function(e,a){-1==jQuery.inArray(a.group,$tabs)&&$tabs.push(a.group),t+=get_element_field(a,n)}),l+='<div class="chl-element-settings"><div class="chl-element-settings-inner">',l+='<div class="chl-element-settings-header">',l+='<div class="chl-element-settings-close"><span class="dashicons dashicons-no"></span></div><div class="chl-element-settings-title">'+a+" "+chl.settings+"</div>",l+='<div class="chl-edit-tabs">',jQuery.each($tabs,function(e,a){$active_tab?(l+='<div class="chl-tabs-title chl-tab-active" data-tab="'+a+'">'+a+"</div>",$active_tab=!1):l+='<div class="chl-tabs-title" data-tab="'+a+'">'+a+"</div>"}),l+="</div>",l+="</div>",l+='<div class="chl-element-settings-content chl-element-settings-edit-content"><div class="chl-element-edit"><form id="header_builder_elements_form" method="get">',l+='<div class="chl-editor-fields">',l+=t,l+="</div>",l+='<div class="chl-edit-action-tabs">',l+='<a class="button button-primary button-large chl-save-element">'+chl.save+"</a>",l+='<a class="button button-secondary button-large chl-close-element">'+chl.cancel+"</a>",l+="</div>",l+="</from></div></div></div></div>",jQuery(".chl-settings-loading").remove(),jQuery(l).appendTo(".chl-device-elements-settings"),jQuery(".chl-device-elements-settings").addClass("chl-elements-settings-show"),fieldsEditorRemove(),fieldsEditor(),getRangeSlider(),fieldsActionHideShow(),formDataDependency(),setColorPicker(),enableSelect2()}})}}),jQuery(".chl-edit-tabs .chl-tabs-title").live("click",function(){if(!jQuery(this).hasClass("chl-tab-active")){jQuery(this).data("tab");jQuery(".chl-edit-tabs .chl-tabs-title").removeClass("chl-tab-active"),jQuery(this).addClass("chl-tab-active"),fieldsActionHideShow()}}),jQuery(".chl-popup-close, .chl-element-settings-close, .chl-popup-overlay, .chl-close-element, .chl-toolbar-devices").live("click",function(e){e.preventDefault(),jQuery(".chl-element-settings").remove(),jQuery(".chl-device-elements-settings").removeClass("chl-elements-settings-show"),jQuery(".chl-element-content").removeClass("chl-element-current"),jQuery(".chl-elements-cover").removeClass("chl-current-row")}),jQuery(".chl-save-element").live("click",function(e){e.preventDefault();var a=jQuery("#header_builder_elements_form").serializeArray(),l=jQuery(".chl-element-content.chl-element-current").data("element_id"),t=jQuery(".chl-element-content.chl-element-current").data("element_title");a.forEach(function(e){if("textarea_html"===e.name){if(jQuery("#wp-textarea_html-wrap").hasClass("tmce-active"))var a=tinymce.get("textarea_html").getContent();else a=jQuery("textarea#textarea_html").val();e.value=encodeURIComponent(a)}}),a.unshift({element_id:l,element_title:t}),$element_json=JSON.stringify(a),jQuery(".chl-element-current").attr("data-element_data",$element_json),jQuery(".chl-element-settings").remove(),jQuery(".chl-device-elements-settings").removeClass("chl-elements-settings-show"),jQuery(".chl-element-content").removeClass("chl-element-current"),jQuery(".chl-elements-cover").removeClass("chl-current-row")}),jQuery(".chl-save").live("click",function(){if(""==jQuery(".layout-title").val())return jQuery(".layout-title").addClass("chl-required"),void jQuery("html, body").animate({scrollTop:jQuery(".layout-title").offset().top-100},1e3);jQuery(".layout-title").removeClass("chl-required");var n={};n.title=jQuery(".layout-title").val(),n.header_id=jQuery(this).data("header_id"),jQuery(".chl-elements-cover").each(function(){var t=jQuery(this).data("possition"),e=jQuery(this).data("element_data");n[t]={},n[t].configuration=[],n[t].configuration=e,jQuery(this).find(".chl-element-contents").each(function(){var l=jQuery(this).data("possition");n[t][l]=[],$i=0,jQuery(this).find(".chl-has-elements .chl-sortable-item").each(function(){var e=jQuery(this).find(".chl-element-content").data("element_id"),a=jQuery(this).find(".chl-element-content").data("element_data");n[t][l][$i]={},n[t][l][$i][e]=a,$i++})})}),jQuery("#wpwrap").append('<div class="chl-overlay"></div>'),jQuery.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{action:"save_header_builder",objects:n},success:function(e){if(jQuery(".chl-overlay").remove(),e.redirect){var a=jQuery(location).attr("href");a+="&header_id="+e.header_id,jQuery(location).attr("href",a)}}})}),jQuery(document).on("click",".header-layout-clone",function(e){e.preventDefault();var a=jQuery(this).data("header_id");jQuery(this);""!=a&&jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"clone_header",headerId:a},dataType:"json",success:function(e){var a=jQuery(location);href=a.attr("protocol")+"//"+a.attr("host")+a.attr("pathname"),jQuery("ul.header-layout-lists").append('<li class="header-layout-list-item"><div class="header-layout-list-item-inner"><a href="'+href+"?page=header-layout&header_id="+e.header_id+'">'+e.header_title+'</a><div class="header-layout-list-actions"><a href="'+href+"?page=header-layout&header_id="+e.header_id+'" class="header-layout-action header-layout-edit"><span class="dashicons dashicons-edit"></span></a><a href="'+href+"?page=header-layout&header_id="+e.header_id+'" class="header-layout-action header-layout-clone" data-header_id="'+e.header_id+'"><span class="dashicons dashicons-admin-page"></span></a><a href="'+href+"?page=header-layout&header_id="+e.header_id+'" class="header-layout-action header-layout-delete" data-header_id="'+e.header_id+'"><span class="dashicons dashicons-trash"></span></a></div></li>')}})}),jQuery(document).on("click",".header-layout-delete",function(e){e.preventDefault();var a=jQuery(this).data("header_id"),l=jQuery(this);""!=a&&confirm("Are you sure to delete this header layout?")&&jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"delete_header",headerId:a},dataType:"json",success:function(e){l.parents("li").remove()}})}),jQuery(".chl-row-configure").live("click",function(){if(!jQuery(this).parents(".chl-elements-cover").hasClass("chl-current-row")){jQuery(".chl-structure").append('<div class="chl-settings-loading"></div>'),jQuery(".chl-device-elements-settings").html(""),jQuery(".chl-device-elements-settings").removeClass("chl-elements-settings-show"),jQuery(".chl-elements-cover").removeClass("chl-current-row"),jQuery(".chl-element-content").removeClass("chl-element-current"),jQuery(this).parents(".chl-elements-cover").addClass("chl-current-row");var a=jQuery(".chl-current-row").data("element_title"),e=jQuery(".chl-current-row").attr("data-element_data"),n="";""!=e&&(elements_data_arr=JSON.parse(e),n=[],jQuery.each(elements_data_arr,function(e,a){n[a.name]=a.value})),jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"header_configure"},dataType:"json",success:function(e){var l="",t="";$tabs=[],$active_tab=!0,jQuery.each(e,function(e,a){-1==jQuery.inArray(a.group,$tabs)&&$tabs.push(a.group),t+=get_element_field(a,n)}),l+='<div class="chl-element-settings"><div class="chl-element-settings-inner">',l+='<div class="chl-element-settings-header">',l+='<div class="chl-element-settings-close"><span class="dashicons dashicons-no"></span></div><div class="chl-element-settings-title">'+chl.configure+" "+a+" "+chl.settings+"</div>",l+='<div class="chl-edit-tabs">',jQuery.each($tabs,function(e,a){$active_tab?(l+='<div class="chl-tabs-title chl-tab-active" data-tab="'+a+'">'+a+"</div>",$active_tab=!1):l+='<div class="chl-tabs-title" data-tab="'+a+'">'+a+"</div>"}),l+="</div>",l+="</div>",l+='<div class="chl-element-settings-content chl-element-settings-edit-content"><div class="chl-element-edit"><form id="header_builder_elements_form" method="get">',l+='<div class="chl-editor-fields">',l+=t,l+="</div>",l+='<div class="chl-edit-action-tabs">',l+='<a class="button button-primary button-large chl-save-configuration">'+chl.save+"</a>",l+='<a class="button button-secondary button-large chl-close-element">'+chl.cancel+"</a>",l+="</div>",l+="</from></div></div></div></div>",jQuery(".chl-settings-loading").remove(),jQuery(".chl-device-elements-settings").append(l),jQuery(".chl-device-elements-settings").addClass("chl-elements-settings-show"),getRangeSlider(),fieldsActionHideShow(),formDataDependency(),setColorPicker(),enableSelect2()}})}}),jQuery(".chl-save-configuration").live("click",function(){var e=jQuery("#header_builder_elements_form").serializeArray();$element_json=JSON.stringify(e),jQuery(".chl-current-row").attr("data-element_data",$element_json),jQuery(".chl-element-settings").remove(),jQuery(".chl-device-elements-settings").removeClass("chl-elements-settings-show"),jQuery(".chl-element-content").removeClass("chl-element-current"),jQuery(".chl-elements-cover").removeClass("chl-current-row")}),elementDraggable(),elementActionHideShow(),fieldsActionHideShow(),jQuery(".chl-field-colorpicker").wpColorPicker(),jQuery(".media-upload").live("click",function(e){e.preventDefault();var a=jQuery(this).parents(".chl-background-setting-field");l||(l=wp.media.frames.file_frame=wp.media({title:"Choose Image",button:{text:"Choose Image",close:!0},multiple:!1})).on("select",function(){var e=l.state().get("selection").first().toJSON();a.find(".chl-field-media-id").val(e.id),a.find(".chl-field-media-src").val(e.url),0<a.find(".chl-field-media-cover img").length?a.find(".chl-field-media-cover img").attr("src",e.url):a.find(".chl-field-media-cover").append('<img src="'+e.url+'"/>'),a.find(".chl-field-media-cover").removeClass("hidden"),a.find(".chl-remove-media-button").removeClass("hidden")}),l.open()}),jQuery(".chl-remove-media-button").live("click",function(){var e=jQuery(this).parents(".chl-background-setting-field");e.find(".chl-field-media-id").val(""),e.find(".chl-field-media-src").val(""),e.find(".chl-field-media-cover img").attr("src",""),e.find(".chl-field-media-cover").addClass("hidden"),jQuery(this).addClass("hidden")})}),jQuery(document).on("click",".chl-field-input",function(){var e=jQuery(this).val(),a=jQuery(this).attr("name"),l=jQuery(".chl-edit-tabs .chl-tabs-title.chl-tab-active").data("tab");jQuery('[data-dependency-element="'+a+'"]').each(function(){dependency=jQuery(this).data("dependency-value"),dependency_tab=jQuery(this).data("content"),-1==jQuery.inArray(e,dependency)?jQuery(this).hide():dependency_tab==l&&jQuery(this).show()})});